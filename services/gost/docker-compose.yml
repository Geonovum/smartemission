version: '3.1'

services:
  gost:
    image: smartemission/gost:latest

    container_name: gost

    env_file:
      # See https://github.com/gost/docs/blob/master/gost_configuration.md
      # for config vars
      - ../../etl/options/${HOSTNAME}.args

      # Or set as env vars
      # GOST_SERVER_EXTERNAL_URI=http://<host>:[port]/gost
      # GOST_DB_HOST=postgis
      # GOST_DB_PORT=
      # GOST_DB_DATABASE=
      # GOST_DB_USER=
      # GOST_DB_PASSWORD=

    labels:
      - "traefik.backend=gost"
      - "traefik.enable=true"
      - "traefik.frontend.priority=500"
      - "traefik.frontend.rule=HostRegexp:{subdomain:[a-z]+}.smartemission.nl;PathPrefixStrip:/gost"
      - "traefik.docker.network=se_front"

    expose:
     - "8080"

    networks:
      - se_front
      - se_back

networks:
  se_front:
    external: true
  se_back:
    external: true
